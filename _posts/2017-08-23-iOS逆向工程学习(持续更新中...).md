---
layout:     post
title:      iOSé€†å‘å·¥ç¨‹å­¦ä¹ ï¼ˆæŒç»­æ›´æ–°ä¸­...ï¼‰
subtitle:   iOSé€†å‘å·¥ç¨‹å­¦ä¹ ï¼ˆæŒç»­æ›´æ–°ä¸­...ï¼‰
date:       2017-06-19
author:     Spades_K
header-img: img/post-bg-rabbit.jpg
catalog: true
tags:
    - Xcode
    - å¼€å‘æŠ€å·§
---


##  1 MACå·¥å…·  
### 1.1 class dump  
åˆ©ç”¨OC runtime ç‰¹æ€§ æŠŠMach-Oæ–‡ä»¶ä¸­@interface å’Œ@protocol æå–å‡ºæ¥å¹¶ç”Ÿæˆå¯¹åº”çš„.hæ–‡ä»¶ã€‚ 

[å®‰è£…æ–¹æ³•](http://www.jianshu.com/p/1e3fe0a8c048)

ç»ˆç«¯å‘½ä»¤ä½¿ç”¨     

```
class-dump -H /Applications/Calculator.app -o ~/Desktop/dump/Calculate-dump
```

/Applications/Calculator.app æ˜¯ Mac ä¸Šè®¡ç®—å™¨åº”ç”¨çš„è·¯å¾„ã€‚

~/Desktop/dump/Calculate-dump æ˜¯æŒ‡å®šçš„å­˜æ”¾ dump å‡ºæ¥å¤´æ–‡ä»¶çš„æ–‡ä»¶å¤¹è·¯å¾„ã€‚

ç¼ºç‚¹ åªèƒ½ä½œç”¨äºæœªç»è¿‡åŠ å¯†çš„æ–‡ä»¶  é€šå¸¸appstore ä¸‹è½½çš„ipaéƒ½ç»è¿‡åŠ å¯† æ€ä¹ˆåŠå‘¢ï¼Ÿ ä¹Ÿå°±æ˜¯ä¸‹ä¸ªå·¥å…· ç ¸å£³å·¥å…· AppCrackr 

### 1.2  AppCrackr (å¾…æ›´æ–°)


### 1.3 Theos 
[å®‰è£…æ–¹æ³•](http://www.jianshu.com/p/d8a7e0381ff7)
ç»ˆç«¯æ“ä½œ ä½¿ç”¨ ï¼ˆè·¯å¾„ä¸ºæ¡Œé¢ï¼‰

```
johndeMacBook:Desktop john$ nic.pl
NIC 2.0 - New Instance Creator
------------------------------
[1.] iphone/activator_event
[2.] iphone/application_modern
[3.] iphone/cydget
[4.] iphone/flipswitch_switch
[5.] iphone/framework
[6.] iphone/ios7_notification_center_widget
[7.] iphone/library
[8.] iphone/notification_center_widget
[9.] iphone/preference_bundle_modern
[10.] iphone/tool
[11.] iphone/tweak
[12.] iphone/xpc_service
Choose a Template (required): 11
Project Name (required): rck
Package Name [com.yourcompany.rck]: com.horck.rck
Author/Maintainer Name [john]: rck
[iphone/tweak] MobileSubstrate Bundle filter [com.apple.springboard]: com.horck.ck      
[iphone/tweak] List of applications to terminate upon installation (space-separated, '-' for none) [SpringBoard]: horck
Instantiating iphone/tweak in rck/...
Done.

```

åœ¨æ¡Œé¢ç”Ÿæˆæ–‡ä»¶

![å±å¹•å¿«ç…§ 2017-06-14 ä¸‹åˆ3.57.06.png](http://upload-images.jianshu.io/upload_images/706610-cc11958fd6eadd2a.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)

controlæ–‡ä»¶è®°å½•debåŒ…ç®¡ç†ç³»ç»Ÿæ‰€éœ€åŸºæœ¬ä¿¡æ¯ï¼Œä¼šè¢«æ‰“è¿›åŒ…ä¸­


![å±å¹•å¿«ç…§ 2017-06-14 ä¸‹åˆ3.57.14.png](http://upload-images.jianshu.io/upload_images/706610-1d065d3efd55430e.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)

[å…·ä½“å­—æ®µä¿¡æ¯å¯ä»¥å‚è€ƒdebianå®˜ç½‘](http://www.debian.org/doc/debian-policy/ch-controlfields.html)

###1.4 reveal  æŸ¥çœ‹appç»“æ„  

**å®‰è£…æ–¹æ³•ä»¥åŠé—®é¢˜æŸ¥çœ‹**

[å…·ä½“è¯·ç‚¹å‡»](http://www.jianshu.com/p/5236ba228076)

[é—®é¢˜å‚è€ƒ](http://blog.csdn.net/quanqinyang/article/details/70872489)

##2 ç ¸å£³å·¥å…·  
[ä¸‹è½½åœ°å€] (https://github.com/stefanesser/dumpdecrypted)

åœ¨ç›®å½•è·¯å¾„ç›´æ¥ è¿è¡Œâ€œmakeâ€ å‘½ä»¤ ç”Ÿæˆ 

![å±å¹•å¿«ç…§ 2017-06-19 ä¸‹åˆ1.44.00.png](http://upload-images.jianshu.io/upload_images/706610-69fd3ff2d0ec56b6.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)

###1 å¯»æ‰¾appåŒ…çš„åœ°å€  

/var/mobile/Containers/Bundle/Application/ç”¨äºå­˜æ”¾StoreAppçš„åº”ç”¨
/var/mobile/Containers/Data/Application/ç”¨äºå­˜æ”¾StoreAppçš„åº”ç”¨æ•°æ®

1.1  é“¾æ¥ç»ˆç«¯è¶Šç‹±æ‰‹æœº " ssh root@ "  å¯†ç ä¸º alpine 

1.2  æ‰‹æœºæ€æ­»æ‰€æœ‰æ²¡å¿…è¦çš„app åªç•™ä¸‹éœ€è¦ç ¸å£³çš„app ç»ˆç«¯è¾“å…¥ "ps -e" è·å–æ‰‹æœºä¸­æ‰€æœ‰è¿›ç¨‹ ï¼ˆ å¦‚æœæç¤º psæŒ‡ä»¤ä¸å­˜åœ¨ é‚£å°±éœ€è¦åˆ° cydia å½“ä¸­å®‰è£… adv-cmds åŒ…ã€‚ï¼‰


```
yanshude-iPhone:~ root# ps -e
PID TTY           TIME CMD
1 ??         1:30.63 /sbin/launchd
194 ??         1:17.02 /usr/sbin/syslogd
/System/Library/Frameworks/Accounts.framework/accountsd
220 ??         0:04.04 /System/Library/PrivateFrameworks/TCC.framework/tccd
230 ??         0:06.79 /System/Library/PrivateFrameworks/IMCore.framework/imagent.app/imagent
233 ??         0:40.82 /usr/libexec/configd
242 ??         0:34.91 /usr/libexec/securityd
244 ??         0:00.80 /usr/sbin/distnoted daemon
248 ??         0:20.48 /usr/libexec/networkd
/Applications/Contacts.app/PlugIns/ContactsCoreSpotlightExtension.appex/ContactsCoreSpotlightExtension
1485 ??         0:51.65 /var/containers/Bundle/Application/EF3744E4-0EC2-47BE-BF2B-2422CFF1D69A/Taobao4iPhone.app/Taobao4iPhone
3511 ??         0:00.07 /System/Library/Frameworks/UIKit.framework/Support/pasteboardd
```


å‡ºæ¥å¾ˆå¤šæ¡ç›®å¯ä»¥ç”¨â€œ/var/containers/Bundle/Application/â€ æœç´¢å®šä½ (ä½œè€…åœ¨åšçš„æ—¶å€™å‡ºç°ä¸ªé—®é¢˜å°±æ˜¯â€œ/var/containers/Bundle/Application/EF3744E4-0EC2-47BE-BF2B-2422CFF1D69A/Taobao4iPhone.app/Taobao4iPhoneâ€ åªå‡ºç°äº†ä¸€åŠ ç±»ä¼¼è¿™æ · "/var/containers/Bundle/Application/EF3744E4-0EC2-47BE" è§£å†³åŠæ³•å°±æ˜¯æŠŠç»ˆç«¯æ˜¾ç¤ºæ¡†æ‹‰å®½ç‚¹ã€‚ã€‚ æ²¡å‡ºç°çš„è¯·ç»•è·¯ï¼‰

1.3 ä½¿ç”¨ Cycript æ‰¾åˆ°ç›®æ ‡åº”ç”¨çš„ Documents ç›®å½•è·¯å¾„ã€‚
éœ€è¦è¶Šç‹±æ‰‹æœºåœ¨ cydia ä¸Šæœç´¢ cycript å¹¶å®‰è£…å°±å¯ä»¥äº†ã€‚

```
yanshude-iPhone:~ root# cycript -p Taobao4iPhone
cy# NSHomeDirectory()
@"/var/mobile/Containers/Data/Application/AA7CA85F-CDDD-4BC2-995D-97A3A9FAC250"
```

é€€å‡º **Cycript** æŒ‰ **control + d** 

1.4  æŠŠ dumpdecrypted.dylib æ–‡ä»¶æ·»åŠ åˆ°ç›®æ ‡appçš„Documents æ–‡ä»¶å¤¹ä¸‹ ä½œè€…è¿™é‡Œæ˜¯ç”¨çš„ cyberduck è¿æ¥çš„æ‰‹æœºï¼ˆå·¥å…·æœ‰å¾ˆå¤šç§  ä¸ªäººæ¯”è¾ƒå–œæ¬¢å¯è§†åŒ–ğŸ˜€ï¼‰

![SSHè¿æ¥æ‰‹æœº](http://upload-images.jianshu.io/upload_images/706610-c4691c128b76bd80.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)


![ç‚¹å‡»è½¬åˆ° æŠŠä¸Šé¢appè·¯å¾„å¤åˆ¶å‡ºæ¥](http://upload-images.jianshu.io/upload_images/706610-35e9b4a1beece4a3.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)

ç„¶åæŠŠdumpdecrypted.dylib æ‹–æ‹½åˆ°Documentsæ–‡ä»¶å¤¹ä¸‹ 

![Documentsç›®å½•](http://upload-images.jianshu.io/upload_images/706610-139cadaceceb2baf.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)

1.5 ç»ˆç«¯æ“ä½œ cd â€œ/var/mobile/Containers/Data/Application/AA7CA85F-CDDD-4BC2-995D-97A3A9FAC250/Documentsâ€ æƒ³è¦æŸ¥çœ‹appçš„è·¯å¾„ä¸‹ æ‰§è¡Œç ¸å£³æ“ä½œ 

æ‰§è¡Œå‘½ä»¤ 


```
yanshude-iPhone:/var/mobile/Containers/Data/Application/AA7CA85F-CDDD-4BC2-995D-97A3A9FAC250/Documents root# /var/containers/Bundle/Application/EF3744E4-0EC2-47BE-BF2B-2422CFF1D69A/Taobao4iPhone.app/Taobao4iPhone
Killed: 9
yanshude-iPhone:/var/mobile/Containers/Data/Application/AA7CA85F-CDDD-4BC2-995D-97A3A9FAC250/Documents root# su mobile
yanshude-iPhone:~/Containers/Data/Application/AA7CA85F-CDDD-4BC2-995D-97A3A9FAC250/Documents mobile$  DYLD_INSERT_LIBRARIES=dumpdecrypted.dylib /var/containers/Bundle/Application/EF3744E4-0EC2-47BE-BF2B-2422CFF1D69A/Taobao4iPhone.app/Taobao4iPhone
mach-o decryption dumper
DISCLAIMER: This tool is only meant for security research purposes, not for application crackers.
[+] detected 64bit ARM binary in memory.
[+] offset to cryptid found: @0x1000d0f20(from 0x1000d0000) = f20
[+] Found encrypted data at address 00004000 of length 58884096 bytes - type 1.
[+] Opening /private/var/containers/Bundle/Application/EF3744E4-0EC2-47BE-BF2B-2422CFF1D69A/Taobao4iPhone.app/Taobao4iPhone for reading.
[+] Reading header
[+] Detecting header type
[+] Executable is a plain MACH-O image
[+] Opening Taobao4iPhone.decrypted for writing.
[+] Copying the not encrypted start of the file
[+] Dumping the decrypted data into the file
[+] Copying the not encrypted remainder of the file
[+] Setting the LC_ENCRYPTION_INFO->cryptid to 0 at offset f20
[+] Closing original file
[+] Closing dump file
yanshude-iPhone:~/Containers/Data/Application/AA7CA85F-CDDD-4BC2-995D-97A3A9FAC250/Documents mobile$ 
```


PS :ä½œè€…å‡ºç°è¿‡é—®é¢˜ " Killedï¼š9  " æ‰§è¡Œ " su mobile"  å†æ¬¡æ‰§è¡Œä¸Šå›¾ç¬¬ä¸€æ¡å‘½ä»¤   


![ç»“æœæ–‡ä»¶å‡ºç°](http://upload-images.jianshu.io/upload_images/706610-7eecc0a70ade5fee.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)

**å‚è€ƒ**

[iOSé€†å‘ä½¿ç”¨dumpdecryptedç»™appç ¸å£³](http://www.jianshu.com/p/14db1ac34bf1)

[iOS é€†å‘æ‰‹æŠŠæ‰‹æ•™ç¨‹ä¹‹ä¸€](http://www.swiftyper.com/2016/05/02/iOS-reverse-step-by-step-part-1-class-dump/)
